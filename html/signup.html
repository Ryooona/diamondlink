<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DiamondLink | アカウント作成</title>
  <link rel="icon" href="/diamondlink/images/fabicon_square.png" type="image/png">
  <link rel="stylesheet" href="/diamondlink/css/style.css?v=2">
  <link rel="stylesheet" href="/diamondlink/css/header.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .required { color: red; margin-left: 5px; }
    .error-message { color: red; font-size: 0.9em; margin-top: 5px; }
  </style>
</head>

<body>

<div id="header-placeholder"></div>

<main class="container">
  <h1>アカウント作成</h1>
  <p>以下の情報を入力してください（※現在はダミーです）。</p>

  <form id="account-form" action="https://formspree.io/f/xqaqaloa" method="POST">

    <!-- ここに氏名、ニックネーム、都道府県、市区町村、生年月日、性別、メールアドレス、パスワード、その他、を入力するフォーム（あなたの送ってくれた内容そのまま） -->
    <!-- 長いのでここは省略、今までと同じです。貼り直し不要。 -->

  </form>

  <p>すでにアカウントをお持ちの方は <a href="#">こちらからログイン</a></p>
</main>

<div id="footer-placeholder"></div>

<!-- JavaScriptまとめ -->
<script>
document.addEventListener('DOMContentLoaded', function() {

  // ヘッダー読み込み
  fetch('/diamondlink/html/header.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('header-placeholder').innerHTML = html;

      // ヘッダーを読み込んだ後、header.jsとheader-menu.jsを読み込む
      const headerScript = document.createElement('script');
      headerScript.src = '/diamondlink/js/header.js';
      document.body.appendChild(headerScript);

      const headerMenuScript = document.createElement('script');
      headerMenuScript.src = '/diamondlink/js/header-menu.js';
      document.body.appendChild(headerMenuScript);
    });

  // フッター読み込み
  fetch('/diamondlink/html/footer.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('footer-placeholder').innerHTML = html;
    });

  // 都道府県選択時に市区町村リストを取得
  const prefectureSelect = document.getElementById('prefecture');
  const citySelect = document.getElementById('city-select');

  if (prefectureSelect && citySelect) {
    prefectureSelect.addEventListener('change', function() {
      const selectedPrefecture = this.value;
      citySelect.innerHTML = '<option value="">選択してください</option>';

      if (selectedPrefecture) {
        fetch('prefecture_city.json')
          .then(response => response.json())
          .then(data => {
            if (data[selectedPrefecture]) {
              data[selectedPrefecture].forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
              });
            }
          });
      }
    });
  }

  // 生年月日入力補助（8桁→スラッシュ付き）
  const birthInput = document.getElementById('birthdate');
  if (birthInput) {
    birthInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 8) value = value.slice(0, 8);
      if (value.length === 8) {
        const year = value.slice(0, 4);
        const month = value.slice(4, 6);
        const day = value.slice(6, 8);
        e.target.value = `${year}/${month}/${day}`;
      } else {
        e.target.value = value;
      }
    });
  }

  // パスワード強度チェック
  const passwordInput = document.getElementById('password');
  const strengthBar = document.getElementById('password-strength-bar');
  const strengthText = document.getElementById('password-strength-text');

  if (passwordInput && strengthBar && strengthText) {
    passwordInput.addEventListener('input', function() {
      const value = passwordInput.value;
      let strength = 0;
      if (/[a-z]/.test(value)) strength++;
      if (/[A-Z]/.test(value)) strength++;
      if (/[0-9]/.test(value)) strength++;
      if (/[^a-zA-Z0-9]/.test(value)) strength++;
      if (value.length >= 8) strength++;

      if (strength <= 2) {
        strengthBar.style.width = "33%";
        strengthBar.style.background = "red";
        strengthText.textContent = "弱い";
        strengthText.style.color = "red";
      } else if (strength <= 4) {
        strengthBar.style.width = "66%";
        strengthBar.style.background = "orange";
        strengthText.textContent = "普通";
        strengthText.style.color = "orange";
      } else {
        strengthBar.style.width = "100%";
        strengthBar.style.background = "green";
        strengthText.textContent = "強い";
        strengthText.style.color = "green";
      }
    });
  }

  // パスワード表示/非表示切り替え
  const togglePassword = document.getElementById('toggle-password');
  if (togglePassword && passwordInput) {
    const eyeIcon = togglePassword.querySelector('i');
    togglePassword.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      if (type === 'password') {
        eyeIcon.classList.remove('fa-eye-slash');
        eyeIcon.classList.add('fa-eye');
      } else {
        eyeIcon.classList.remove('fa-eye');
        eyeIcon.classList.add('fa-eye-slash');
      }
    });
  }

  // フォームバリデーション
  const form = document.getElementById('account-form');
  if (form) {
    form.addEventListener('submit', function(event) {
      let hasError = false;
      let errorMessages = [];

      const lastName = document.getElementById('last-name').value.trim();
      const firstName = document.getElementById('first-name').value.trim();
      const nickname = document.getElementById('nickname').value.trim();
      const prefecture = document.getElementById('prefecture').value;
      const city = document.getElementById('city-select').value;
      const birthdate = document.getElementById('birthdate').value.trim();
      const gender = document.querySelector('select[name="gender"]').value;
      const password = document.getElementById('password').value;
      const teamMemberYes = document.getElementById('team-member-yes').checked;
      const teamMemberNo = document.getElementById('team-member-no').checked;

      if (lastName === '') { document.getElementById('error-last-name').textContent = '姓を入力してください。'; hasError = true; }
      else { document.getElementById('error-last-name').textContent = ''; }
      if (firstName === '') { document.getElementById('error-first-name').textContent = '名を入力してください。'; hasError = true; }
      else { document.getElementById('error-first-name').textContent = ''; }
      if (nickname === '') { document.getElementById('error-nickname').textContent = 'ニックネームを入力してください。'; hasError = true; }
      else { document.getElementById('error-nickname').textContent = ''; }
      if (prefecture === '') { document.getElementById('error-prefecture').textContent = '都道府県を選択してください。'; hasError = true; }
      else { document.getElementById('error-prefecture').textContent = ''; }
      if (city === '') { document.getElementById('error-city').textContent = '市区町村を選択してください。'; hasError = true; }
      else { document.getElementById('error-city').textContent = ''; }
      if (birthdate === '') { document.getElementById('error-birthdate').textContent = '生年月日を入力してください。'; hasError = true; }
      else { document.getElementById('error-birthdate').textContent = ''; }
      if (gender === '') { document.getElementById('error-gender').textContent = '性別を選択してください。'; hasError = true; }
      else { document.getElementById('error-gender').textContent = ''; }
      if (password.length < 6) { document.getElementById('error-password').textContent = 'パスワードは6文字以上で入力してください。'; hasError = true; }
      else { document.getElementById('error-password').textContent = ''; }
      if (!teamMemberYes && !teamMemberNo) { document.getElementById('error-team-member').textContent = 'チーム加入状況を選択してください。'; hasError = true; }
      else { document.getElementById('error-team-member').textContent = ''; }

      if (hasError) {
        event.preventDefault();
      }
    });
  }

});
</script>

</body>
</html>
